<%- include('../includes/dashboard-header') %>

<div class="dashboard-container">
  <!-- Sayfa Ba≈ülƒ±ƒüƒ± -->
  <div class="page-header">
    <h1>üìà Makro Ekonomi</h1>
    <p class="page-subtitle">√úlkelerin ekonomik g√∂stergelerini inceleyin</p>
  </div>

  <!-- √úlke Se√ßici -->
  <section class="country-selector-section">
    <div class="selector-card">
      <label for="countrySelect">√úlke Se√ßin:</label>
      <select id="countrySelect" class="country-select">
        <% if (typeof countries !== 'undefined' && countries.length > 0) { %>
          <% countries.forEach(function(country) { %>
            <option value="<%= country.ISO_KODU %>" 
              <%= selectedCountry && selectedCountry.ISO_KODU === country.ISO_KODU ? 'selected' : '' %>>
              <%= country.ulke_adi %>
            </option>
          <% }); %>
        <% } %>
      </select>
    </div>
  </section>

  <% if (hasData && kpiData) { %>
    <!-- KPI Kartlarƒ± - Ekonomik G√∂stergeler -->
    <section class="kpi-section economy-kpis">
      <div class="kpi-grid four-cols">
        <!-- Enflasyon -->
        <div class="kpi-card economy-card">
          <div class="kpi-icon <%= kpiData.enflasyon.status %>">
            <span>üìä</span>
          </div>
          <div class="kpi-content">
            <h3 class="kpi-value"><%= kpiData.enflasyon.value %></h3>
            <p class="kpi-label">Enflasyon Oranƒ±</p>
            <span class="kpi-indicator <%= kpiData.enflasyon.status %>">
              <%= kpiData.enflasyon.status === 'good' ? '‚úì D√º≈ü√ºk' : kpiData.enflasyon.status === 'warning' ? '‚ö† Orta' : '‚ö† Y√ºksek' %>
            </span>
          </div>
        </div>

        <!-- ƒ∞≈üsizlik -->
        <div class="kpi-card economy-card">
          <div class="kpi-icon <%= kpiData.issizlik.status %>">
            <span>üë•</span>
          </div>
          <div class="kpi-content">
            <h3 class="kpi-value"><%= kpiData.issizlik.value %></h3>
            <p class="kpi-label">ƒ∞≈üsizlik Oranƒ±</p>
            <span class="kpi-indicator <%= kpiData.issizlik.status %>">
              <%= kpiData.issizlik.status === 'good' ? '‚úì D√º≈ü√ºk' : kpiData.issizlik.status === 'warning' ? '‚ö† Orta' : '‚ö† Y√ºksek' %>
            </span>
          </div>
        </div>

        <!-- Ki≈üi Ba≈üƒ± GSYH -->
        <div class="kpi-card economy-card">
          <div class="kpi-icon <%= kpiData.gsyhKisiBasi.status %>">
            <span>üí∞</span>
          </div>
          <div class="kpi-content">
            <h3 class="kpi-value"><%= kpiData.gsyhKisiBasi.value %></h3>
            <p class="kpi-label">Ki≈üi Ba≈üƒ± Gelir</p>
            <span class="kpi-indicator <%= kpiData.gsyhKisiBasi.status %>">
              <%= kpiData.gsyhKisiBasi.status === 'good' ? '‚úì Y√ºksek' : kpiData.gsyhKisiBasi.status === 'warning' ? '‚ö† Orta' : '‚ö† D√º≈ü√ºk' %>
            </span>
          </div>
        </div>

        <!-- Risk Notu -->
        <div class="kpi-card economy-card risk-card">
          <div class="kpi-content centered">
            <p class="kpi-label">Kredi Risk Notu</p>
            <h3 class="risk-rating <%= kpiData.riskNotu.color %>"><%= kpiData.riskNotu.value %></h3>
            <span class="rating-agency">Uluslararasƒ± Derecelendirme</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Detay Kartlarƒ± -->
    <section class="detail-cards-section">
      <div class="detail-grid">
        <div class="detail-card">
          <span class="detail-icon">üè¶</span>
          <div class="detail-info">
            <span class="detail-label">GSYH</span>
            <span class="detail-value"><%= kpiData.gsyh %></span>
          </div>
        </div>
        <div class="detail-card">
          <span class="detail-icon">üí≥</span>
          <div class="detail-info">
            <span class="detail-label">Dƒ±≈ü Bor√ß</span>
            <span class="detail-value"><%= kpiData.disBorc %></span>
          </div>
        </div>
        <div class="detail-card">
          <span class="detail-icon">‚öñÔ∏è</span>
          <div class="detail-info">
            <span class="detail-label">Cari Denge</span>
            <span class="detail-value"><%= kpiData.cariDenge %></span>
          </div>
        </div>
        <div class="detail-card">
          <span class="detail-icon">üìà</span>
          <div class="detail-info">
            <span class="detail-label">Faiz Oranƒ±</span>
            <span class="detail-value"><%= kpiData.faizOrani %></span>
          </div>
        </div>
        <div class="detail-card">
          <span class="detail-icon">üèß</span>
          <div class="detail-info">
            <span class="detail-label">D√∂viz Rezervi</span>
            <span class="detail-value"><%= kpiData.dovizRezervi %></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Harita -->
    <section class="map-section-full">
      <div class="card">
        <div class="card-header">
          <h2>üó∫Ô∏è Ki≈üi Ba≈üƒ± Gelir Haritasƒ±</h2>
          <span class="card-subtitle">√úlkelere g√∂re GSYH/Ki≈üi ($)</span>
        </div>
        <div class="card-body">
          <div id="world-map" class="world-map"></div>
        </div>
      </div>
    </section>

    <!-- JavaScript -->
    <script>
      const mapData = <%- mapData %>;

      // √úlke deƒüi≈ütiƒüinde sayfayƒ± yenile
      document.getElementById('countrySelect').addEventListener('change', function() {
        window.location.href = '/economics?country=' + this.value;
      });

      // Harita
      $(document).ready(function() {
        if (Object.keys(mapData).length > 0) {
          $('#world-map').vectorMap({
            map: 'world_mill_en',
            backgroundColor: 'transparent',
            zoomOnScroll: false,
            regionStyle: {
              initial: {
                fill: '#e4e4e4',
                'fill-opacity': 1,
                stroke: '#ffffff',
                'stroke-width': 1
              },
              hover: { 'fill-opacity': 0.8, cursor: 'pointer' }
            },
            series: {
              regions: [{
                values: mapData,
                scale: ['#FED7D7', '#22543D'],
                normalizeFunction: 'polynomial'
              }]
            },
            onRegionTipShow: function(e, el, code) {
              if (mapData[code]) {
                el.html(el.html() + '<br><strong>Ki≈üi Ba≈üƒ±: $' + mapData[code].toLocaleString() + '</strong>');
              }
            },
            onRegionClick: function(e, code) {
              window.location.href = '/economics?country=' + code;
            }
          });
        }
      });
    </script>

  <% } else { %>
    <!-- Empty State -->
    <section class="empty-state-section">
      <div class="empty-state-card">
        <div class="empty-state-icon">üìà</div>
        <h2>Ekonomi Verisi Bulunamadƒ±</h2>
        <p class="empty-state-message">
          Veritabanƒ±nda hen√ºz ekonomi verisi bulunmuyor.
        </p>
      </div>
    </section>
  <% } %>
</div>

<style>
  /* √úlke Se√ßici */
  .country-selector-section {
    margin-bottom: 2rem;
  }

  .selector-card {
    background: #fff;
    padding: 1.5rem 2rem;
    border-radius: 1rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .selector-card label {
    font-weight: 600;
    font-size: 1.4rem;
    color: #2d3748;
  }

  .country-select {
    padding: 1rem 2rem;
    font-size: 1.4rem;
    border: 2px solid #e2e8f0;
    border-radius: 0.8rem;
    background: #fff;
    min-width: 250px;
    cursor: pointer;
  }

  .country-select:focus {
    outline: none;
    border-color: #2c5282;
  }

  /* Ekonomi KPI Kartlarƒ± */
  .economy-kpis .kpi-grid.four-cols {
    grid-template-columns: repeat(4, 1fr);
  }

  .economy-card .kpi-icon.good {
    background: linear-gradient(135deg, #48BB78 0%, #276749 100%);
  }

  .economy-card .kpi-icon.warning {
    background: linear-gradient(135deg, #ECC94B 0%, #B7791F 100%);
  }

  .economy-card .kpi-icon.danger {
    background: linear-gradient(135deg, #F56565 0%, #C53030 100%);
  }

  .kpi-indicator {
    display: inline-block;
    padding: 0.3rem 0.8rem;
    border-radius: 1rem;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .kpi-indicator.good { background: #C6F6D5; color: #22543D; }
  .kpi-indicator.warning { background: #FEFCBF; color: #744210; }
  .kpi-indicator.danger { background: #FED7D7; color: #822727; }

  /* Risk Kartƒ± */
  .risk-card {
    background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
    color: #fff;
  }

  .risk-card .kpi-content.centered {
    text-align: center;
  }

  .risk-card .kpi-label {
    color: rgba(255,255,255,0.8);
  }

  .risk-rating {
    font-size: 4rem;
    font-weight: 800;
    margin: 1rem 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
  }

  .risk-rating.green { color: #48BB78; }
  .risk-rating.lightgreen { color: #9AE6B4; }
  .risk-rating.yellow { color: #ECC94B; }
  .risk-rating.orange { color: #ED8936; }
  .risk-rating.red { color: #F56565; }
  .risk-rating.darkred { color: #E53E3E; }
  .risk-rating.gray { color: #A0AEC0; }

  .rating-agency {
    font-size: 1.1rem;
    color: rgba(255,255,255,0.6);
  }

  /* Detay Kartlarƒ± */
  .detail-cards-section {
    margin: 2rem 0;
  }

  .detail-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1.5rem;
  }

  .detail-card {
    background: #fff;
    padding: 1.5rem;
    border-radius: 1rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .detail-icon {
    font-size: 2.5rem;
  }

  .detail-info {
    display: flex;
    flex-direction: column;
  }

  .detail-label {
    font-size: 1.2rem;
    color: #718096;
  }

  .detail-value {
    font-size: 1.6rem;
    font-weight: 700;
    color: #2d3748;
  }

  /* Harita Section */
  .map-section-full {
    margin-top: 2rem;
  }

  .map-section-full .world-map {
    height: 450px;
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .economy-kpis .kpi-grid.four-cols {
      grid-template-columns: repeat(2, 1fr);
    }
    .detail-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .economy-kpis .kpi-grid.four-cols {
      grid-template-columns: 1fr;
    }
    .detail-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>

<%- include('../includes/dashboard-footer') %>
